# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
## Система глубокого анализа и генерации персонализированных сопроводительных писем v3.0
**Подход: Smart Prompts + GPT**

---

## 1. ОБЩЕЕ ОПИСАНИЕ ПРОЕКТА

### 1.1 Цель проекта
Создание системы генерации персонализированных сопроводительных писем через **умные промпты для GPT**, которые заменяют сложную архитектуру из парсеров и моделей.

### 1.2 Ключевая идея v3.0
**Вместо сложного кода** → **Умные промпты**
- Глубокий анализ через детальные инструкции для GPT
- Пошаговый процесс анализа в одном промпте  
- Структурированный JSON-ответ от GPT
- Человечная генерация через анти-ИИ промпты

### 1.3 Преимущества подхода
- ✅ **Простота**: минимум кода, максимум результата
- ✅ **Гибкость**: легко изменить логику через промпты
- ✅ **Качество**: GPT лучше любых самописных парсеров
- ✅ **Скорость**: быстрая разработка и итерации

---

## 2. АРХИТЕКТУРА РЕШЕНИЯ

### 2.1 Простая структура
```
services/
├── smart_analyzer.py     # Главный анализатор с промптами
├── prompt_templates.py   # Шаблоны промптов 
├── openai_service.py     # Обновленный сервис для GPT
└── human_writer.py       # Человечная генерация

utils/
└── prompt_utils.py       # Утилиты для работы с промптами
```

### 2.2 Флоу работы
```
1. Вакансия + Резюме
   ↓
2. Smart Analyzer (GPT с умным промптом)
   ↓ 
3. Структурированный JSON с анализом
   ↓
4. Human Writer (GPT с анти-ИИ промптом)
   ↓
5. Готовое человечное письмо
```

---

## 3. СИСТЕМА УМНЫХ ПРОМПТОВ

### 3.1 Промпт для глубокого анализа

```python
DEEP_ANALYSIS_PROMPT = """
Ты эксперт-аналитик по HR и рекрутингу. Проведи глубокий анализ вакансии и резюме.

ЗАДАЧА: Пошагово проанализируй и верни структурированный JSON

ЭТАПЫ АНАЛИЗА:

1. АНАЛИЗ ВАКАНСИИ:
   - Извлеки ключевые требования (обязательные/желательные)
   - Выяви скрытые болевые точки компании 
   - Определи приоритеты работодателя
   - Проанализируй корпоративную культуру
   - Найди сигналы срочности и роста

2. АНАЛИЗ РЕЗЮМЕ:  
   - Извлеки опыт, навыки, достижения
   - Найди количественные метрики и результаты
   - Определи уникальные преимущества (USP)
   - Проанализируй карьерную траекторию
   - Выяви transferable skills

3. СТРАТЕГИЧЕСКОЕ СОПОСТАВЛЕНИЕ:
   - Найди прямые совпадения навыков
   - Определи переносимые навыки  
   - Выяви пробелы и способы их закрытия
   - Создай стратегию позиционирования
   - Подготовь конкретные отсылки к вакансии

ФОРМАТ ОТВЕТА: JSON
{
  "vacancy_analysis": {
    "key_requirements": [...],
    "pain_points": [...], 
    "priorities": [...],
    "company_culture": "...",
    "urgency_signals": [...],
    "hidden_needs": [...]
  },
  "resume_analysis": {
    "key_skills": [...],
    "achievements": [...],
    "unique_advantages": [...],
    "career_trajectory": "...",
    "transferable_skills": [...]
  },
  "matching_strategy": {
    "direct_matches": [...],
    "skill_gaps": [...],
    "positioning": "...",
    "value_proposition": "...",
    "specific_references": [...]
  },
  "confidence_score": 0.85
}

ВАКАНСИЯ:
{vacancy_text}

РЕЗЮМЕ:
{resume_text}
"""
```

### 3.2 Промпт для человечной генерации

```python
HUMAN_WRITING_PROMPT = """
Ты опытный специалист по написанию сопроводительных писем. 
Твоя задача - создать ЕСТЕСТВЕННОЕ, ЧЕЛОВЕЧНОЕ письмо без ИИ-штампов.

АНАЛИЗ ИЗ ПРЕДЫДУЩЕГО ЭТАПА:
{analysis_json}

ТРЕБОВАНИЯ К ПИСЬМУ:
1. ЧЕЛОВЕЧНОСТЬ: 
   ❌ Избегай: "хотел бы выразить заинтересованность", "рассмотрите мою кандидатуру"
   ✅ Используй: естественные обороты, личные инсайты

2. КОНКРЕТНОСТЬ:
   - Прямые отсылки к пунктам вакансии
   - Количественные метрики из опыта
   - Конкретные примеры решения проблем

3. СТРАТЕГИЧНОСТЬ:
   - Покажи понимание болевых точек компании
   - Позиционируй через уникальные преимущества
   - Предложи конкретную ценность

4. СТРУКТУРА:
   - Интригующее начало (не "пишу по поводу вакансии")
   - 2-3 абзаца с конкретными примерами  
   - Естественное завершение с next step

АНТИ-ИИ ПРАВИЛА:
- Никаких клише типа "идеально подхожу"
- Никаких формальных оборотов
- Живые переходы между абзацами
- Персональные инсайты и мотивация

СТИЛЬ: {writing_style}

Создай письмо, которое HR не отличит от написанного опытным человеком.
"""
```

### 3.3 Промпт для деИИ-фикации

```python
DEAI_PROMPT = """
Проверь текст на ИИ-штампы и сделай его более человечным.

ДЕТЕКТИРУЕМЫЕ ПАТТЕРНЫ:
- "хотел бы выразить заинтересованность" 
- "рассмотрите мою кандидатуру"
- "идеально подхожу для позиции"
- "уникальная комбинация навыков"
- "готов внести значительный вклад"

ЗАМЕНИ НА ЧЕЛОВЕЧНЫЕ ВАРИАНТЫ:
- "заметил вашу вакансию и понял - это то, что искал"
- "ваше объявление привлекло внимание"
- "думаю, мой опыт здесь пригодится"

ТЕКСТ ДЛЯ ПРОВЕРКИ:
{text}

Верни улучшенный вариант с пометками изменений.
"""
```

---

## 4. РЕАЛИЗАЦИЯ

### 4.1 Главный файл анализатора

```python
# services/smart_analyzer.py
class SmartAnalyzer:
    def __init__(self, openai_service):
        self.openai = openai_service
        
    def deep_analyze(self, vacancy_text: str, resume_text: str) -> dict:
        """Глубокий анализ через GPT"""
        prompt = DEEP_ANALYSIS_PROMPT.format(
            vacancy_text=vacancy_text,
            resume_text=resume_text
        )
        
        response = self.openai.get_completion(
            prompt=prompt,
            temperature=0.3,  # Для структурированного анализа
            max_tokens=2000
        )
        
        return json.loads(response)
    
    def generate_human_letter(self, analysis: dict, style: str = "professional") -> str:
        """Генерация человечного письма"""
        prompt = HUMAN_WRITING_PROMPT.format(
            analysis_json=json.dumps(analysis, ensure_ascii=False, indent=2),
            writing_style=style
        )
        
        response = self.openai.get_completion(
            prompt=prompt,
            temperature=0.7,  # Для креативности
            max_tokens=1500
        )
        
        return response
    
    def deai_text(self, text: str) -> str:
        """ДеИИ-фикация текста"""
        prompt = DEAI_PROMPT.format(text=text)
        
        response = self.openai.get_completion(
            prompt=prompt,
            temperature=0.5,
            max_tokens=1500
        )
        
        return response
```

### 4.2 Обновление OpenAI сервиса

```python
# Добавить в services/openai_service.py
def generate_deep_analysis_letter(
    self, 
    job_description: str, 
    resume: str,
    style: str = "professional"
) -> str:
    """Генерация письма через глубокий анализ v3.0"""
    
    analyzer = SmartAnalyzer(self)
    
    # Этап 1: Глубокий анализ
    analysis = analyzer.deep_analyze(job_description, resume)
    
    # Этап 2: Генерация письма
    letter = analyzer.generate_human_letter(analysis, style)
    
    # Этап 3: ДеИИ-фикация
    final_letter = analyzer.deai_text(letter)
    
    return final_letter
```

---

## 5. ПЛАН РЕАЛИЗАЦИИ

### Фаза 1: Основные промпты (1 неделя)
- [ ] Создать `services/smart_analyzer.py`
- [ ] Написать промпт для глубокого анализа
- [ ] Написать промпт для человечной генерации  
- [ ] Протестировать на реальных примерах

### Фаза 2: Анти-ИИ система (1 неделя)
- [ ] Создать промпт для деИИ-фикации
- [ ] Добавить базу ИИ-штампов и альтернатив
- [ ] Интегрировать в основной флоу
- [ ] A/B тестирование результатов

### Фаза 3: Интеграция в бота (1 неделя)  
- [ ] Обновить `openai_service.py`
- [ ] Добавить новый режим в персонализированный флоу
- [ ] Протестировать через Telegram бота
- [ ] Сбор обратной связи пользователей

### Фаза 4: Оптимизация (ongoing)
- [ ] Улучшение промптов на основе результатов
- [ ] Добавление новых стилей генерации
- [ ] Мониторинг качества и времени ответов
- [ ] Расширение анти-ИИ паттернов

---

## 6. КРИТЕРИИ КАЧЕСТВА

### 6.1 Технические метрики
- **Время генерации:** < 60 секунд (вместо 90)
- **Точность анализа:** > 90% релевантных совпадений  
- **Структурированность JSON:** 100% валидные ответы

### 6.2 Качественные критерии
- **Человечность:** HR не отличает от написанного человеком
- **Конкретность:** Прямые отсылки к 80%+ требований вакансии
- **Уникальность:** Каждое письмо содержит персональные инсайты
- **Отсутствие ИИ-штампов:** < 5% клише в финальном тексте

### 6.3 Пример качества

#### ❌ Старый подход (v2.0):
```
"Хотел бы выразить заинтересованность в вакансии Frontend разработчика. 
Обладаю уникальной комбинацией навыков и готов внести значительный вклад в развитие компании."
```

#### ✅ Новый подход (v3.0):
```
"Увидел вашу вакансию Senior Frontend разработчика и сразу понял - вы ищете кого-то, 
кто может решить проблему с производительностью React-приложения. 

В Тинькофф мне как раз довелось оптимизировать торговый терминал - снизил время 
первой загрузки с 12 до 3 секунд через code splitting и ленивую загрузку модулей. 
Учитывая, что у вас финтех и каждая секунда конверсии критична, думаю, этот опыт 
будет полезен для вашей задачи масштабирования до 500k пользователей."
```

---

## 7. ПРЕИМУЩЕСТВА НОВОГО ПОДХОДА

### 7.1 Для разработки
- **Скорость**: реализация за 3 недели вместо 8
- **Простота**: 300 строк кода вместо 3000
- **Гибкость**: изменения через промпты, не код

### 7.2 Для пользователей  
- **Качество**: GPT лучше самописных алгоритмов
- **Скорость**: генерация за 30-60 секунд
- **Персонализация**: каждое письмо уникально

### 7.3 Для поддержки
- **Отладка**: легко понять что делает промпт
- **Улучшения**: правки в промптах без релизов
- **Масштабирование**: добавление новых функций через промпты

---

**Версия ТЗ:** 3.0 (Smart Prompts)  
**Подход:** GPT + Умные промпты  
**Статус:** Готов к реализации 🚀