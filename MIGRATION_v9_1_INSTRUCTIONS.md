# üîÑ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ú–ò–ì–†–ê–¶–ò–ò v9.1 + v9.4

## üìã –ß–¢–û –î–ï–õ–ê–ï–¢ –ú–ò–ì–†–ê–¶–ò–Ø

### v9.1 - Legal Documents
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è —Å–æ–≥–ª–∞—Å–∏—è –≤ —Ç–∞–±–ª–∏—Ü—É `users`
- ‚úÖ **–ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ = TRUE –≤—Å–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º** (implied consent)
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Å–æ–≥–ª–∞—Å–∏—é
- ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ –∫–æ–º–∞–Ω–¥—ã `/privacy`, `/terms`

### v9.4 - Bugfix Subscription Unlimited  
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥:** –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞–ª–∏ Unlimited –≤–º–µ—Å—Ç–æ Free
- ‚úÖ –£–¥–∞–ª—è–µ—Ç –º–µ—Ç–æ–¥ `_unlimited_access()` 
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç Free –ø–æ–¥–ø–∏—Å–∫—É —Å 3 –ø–∏—Å—å–º–∞–º–∏

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ú–ò–ì–†–ê–¶–ò–Æ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export SUPABASE_URL="your_supabase_url"
export SUPABASE_KEY="your_supabase_key"

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
python run_migration_v9_1.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL
```bash
# –ó–∞–≥—Ä—É–∂–∞–µ–º SQL —Ñ–∞–π–ª –≤ Supabase Dashboard ‚Üí SQL Editor
# –í—ã–ø–æ–ª–Ω—è–µ–º migrate_v9_1_add_consent_fields.sql
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ Python –∫–æ–¥
```python
from supabase import create_client

client = create_client(SUPABASE_URL, SUPABASE_KEY)

# –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –∏–∑ migrate_v9_1_add_consent_fields.sql
with open('migrate_v9_1_add_consent_fields.sql', 'r') as f:
    sql_commands = f.read()
    
# –í—ã–ø–æ–ª–Ω—è–µ–º —á–µ—Ä–µ–∑ Supabase
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üéØ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ = TRUE**
- üìÖ **–õ–æ–≥–∏–∫–∞:** –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –ø–∏—Å—å–º–∞, –∑–Ω–∞—á–∏—Ç –æ–Ω —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—Å–∏–ª—Å—è
- üîí **–í–µ—Ä—Å–∏—è —Å–æ–≥–ª–∞—Å–∏—è:** v1.0 (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª–∏—Ç–∏–∫–∏)
- üìß **–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ:** FALSE (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è)

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ users
```sql
consent_given BOOLEAN DEFAULT NULL     -- TRUE/FALSE/NULL
consent_timestamp TIMESTAMP           -- –∫–æ–≥–¥–∞ –¥–∞–Ω–æ —Å–æ–≥–ª–∞—Å–∏–µ  
consent_version VARCHAR(10)           -- –≤–µ—Ä—Å–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏
marketing_consent BOOLEAN DEFAULT FALSE -- —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–µ–∫–ª–∞–º—É
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ **–û—Ç–∫–∞—Ç—ã–≤–∞–µ–º–æ:** –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ **–ë–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö:** –≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –Ω–∏–∫–∞–∫–∏—Ö —É–¥–∞–ª–µ–Ω–∏–π
- ‚úÖ **–° –ø—Ä–æ–≤–µ—Ä–∫–æ–π:** `IF NOT EXISTS` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üß™ –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—è –≤ –ë–î
```sql
SELECT column_name, data_type, is_nullable, column_default 
FROM information_schema.columns 
WHERE table_name = 'users' 
  AND column_name IN ('consent_given', 'consent_timestamp', 'consent_version', 'marketing_consent');
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Å–æ–≥–ª–∞—Å–∏–µ–º
```sql
SELECT 
  consent_given,
  consent_version,
  COUNT(*) as user_count
FROM users 
WHERE id IS NOT NULL
GROUP BY consent_given, consent_version;
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–æ—Ç–µ
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É "–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è 3/3"
- –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Unlimited 999999/999999"

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã
- `/support` ‚Üí –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å @shoodyakoff
- `/privacy` ‚Üí –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
- `/terms` ‚Üí –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ

---

## üîß –û–¢–ö–ê–¢ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
```sql
-- –£–¥–∞–ª—è–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—è (–û–°–¢–û–†–û–ñ–ù–û!)
DROP INDEX IF EXISTS idx_users_consent_version;
DROP INDEX IF EXISTS idx_users_consent;
ALTER TABLE users DROP COLUMN IF EXISTS marketing_consent;
ALTER TABLE users DROP COLUMN IF EXISTS consent_version;
ALTER TABLE users DROP COLUMN IF EXISTS consent_timestamp;
ALTER TABLE users DROP COLUMN IF EXISTS consent_given;
```

### –û—Ç–∫–∞—Ç –∫–æ–¥–∞
```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞
git revert HEAD

# –ò–ª–∏ –∂–µ—Å—Ç–∫–∏–π –æ—Ç–∫–∞—Ç (–û–°–¢–û–†–û–ñ–ù–û!)
git reset --hard HEAD~1
```

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–û –º–∏–≥—Ä–∞—Ü–∏–∏
```
‚ùå –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   –ü–æ–¥–ø–∏—Å–∫–∞: Unlimited  
   üü¢ –ü–∏—Å–µ–º –æ—Å—Ç–∞–ª–æ—Å—å: 999999/999999

‚ùå /support ‚Üí —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç —Å –±–∞–≥–∞–º–∏
‚ùå –ù–ï–¢ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
```

### –ü–û–°–õ–ï –º–∏–≥—Ä–∞—Ü–∏–∏
```
‚úÖ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
   –ü–æ–¥–ø–∏—Å–∫–∞: –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è
   üü¢ –ü–∏—Å–µ–º –æ—Å—Ç–∞–ª–æ—Å—å: 3/3

‚úÖ /support ‚Üí @shoodyakoff
‚úÖ /privacy ‚Üí –ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
‚úÖ /terms ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: —Å–æ–≥–ª–∞—Å–∏–µ = TRUE
```

---

## üéØ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –ü–†–û–î–ê–ö–®–ï–ù–£

- ‚úÖ **v9.1 Legal Documents** - –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û
- ‚úÖ **v9.4 Bugfix Subscriptions** - –ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í–û  
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** - –ì–û–¢–û–í–ê –ö –ó–ê–ü–£–°–ö–£
- ‚úÖ **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏** - –ì–û–¢–û–í–´
- ‚úÖ **–û—Ç–∫–∞—Ç** - –ì–û–¢–û–í

**üöÄ –ú–û–ñ–ù–û –î–ï–ü–õ–û–ò–¢–¨ –ù–ê –ü–†–û–î–ê–ö–®–ï–ù!** 

# üîß –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –ú–∏–≥—Ä–∞—Ü–∏—è v9.1 - –ü–æ–ª—è —Å–æ–≥–ª–∞—Å–∏—è

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û
**–ë–µ–∑ —ç—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!** 
–û—à–∏–±–∫–∞: `column users.consent_given does not exist`

## üìã **–®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

### 1. **–û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard**
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ–µ–∫—Ç: https://supabase.com/dashboard
- –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç

### 2. **–û—Ç–∫—Ä–æ–π—Ç–µ SQL Editor**
- –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ "SQL Editor"
- –ù–∞–∂–º–∏—Ç–µ "New query"

### 3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é**
```sql
-- –ú–ò–ì–†–ê–¶–ò–Ø v9.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Å–æ–≥–ª–∞—Å–∏—è –¥–ª—è –§–ó-152
-- –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ Supabase SQL Editor

-- 1. –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è —Å–æ–≥–ª–∞—Å–∏—è
ALTER TABLE users ADD COLUMN IF NOT EXISTS consent_given BOOLEAN DEFAULT NULL;
ALTER TABLE users ADD COLUMN IF NOT EXISTS consent_timestamp TIMESTAMP DEFAULT NULL;
ALTER TABLE users ADD COLUMN IF NOT EXISTS consent_version VARCHAR(10) DEFAULT 'v1.0';
ALTER TABLE users ADD COLUMN IF NOT EXISTS marketing_consent BOOLEAN DEFAULT FALSE;

-- 2. –ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–≥–ª–∞—Å–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º (implied consent)
UPDATE users 
SET consent_given = TRUE, 
    consent_timestamp = NOW(), 
    consent_version = 'v1.0',
    marketing_consent = FALSE
WHERE id IS NOT NULL 
  AND consent_given IS NULL;

-- 3. –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_users_consent ON users(consent_given, consent_timestamp);

-- 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
SELECT 
  consent_given,
  consent_version,
  COUNT(*) as user_count
FROM users 
WHERE id IS NOT NULL
GROUP BY consent_given, consent_version;
```

### 4. **–ù–∞–∂–º–∏—Ç–µ "Run"**
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫

### 5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ:
```
consent_given | consent_version | user_count
true          | v1.0           | 5
```

## ‚úÖ **–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:**
- –ë–æ—Ç —Å–Ω–æ–≤–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å —Ç–µ–∫—Å—Ç —Å–æ–≥–ª–∞—Å–∏—è
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—Ç —Å—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üö® **–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**
```sql
-- –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ!)
DROP INDEX IF EXISTS idx_users_consent;
ALTER TABLE users DROP COLUMN IF EXISTS marketing_consent;
ALTER TABLE users DROP COLUMN IF EXISTS consent_version;
ALTER TABLE users DROP COLUMN IF EXISTS consent_timestamp;
ALTER TABLE users DROP COLUMN IF EXISTS consent_given;
``` 