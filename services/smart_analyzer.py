"""
Smart Analyzer v7.0 - UNIFIED LETTER GENERATION
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è
–¢–æ–ª—å–∫–æ —Ç–≤–æ–π –ø—Ä–æ–º–ø—Ç ‚Üí AI ‚Üí –≥–æ—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ
"""
import logging
from typing import Optional

logger = logging.getLogger(__name__)


async def generate_simple_letter(
    vacancy_text: str,
    resume_text: str,
    ai_service=None,
    user_id: Optional[int] = None,
    session_id: Optional[str] = None
) -> str:
    """
    üéØ –ï–î–ò–ù–°–¢–í–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: –í–∞–∫–∞–Ω—Å–∏—è + –†–µ–∑—é–º–µ ‚Üí –ì–æ—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ
    """
    if ai_service is None:
        from services.ai_factory import get_ai_service
        ai_service = get_ai_service()
    
    # –¢–í–û–ô –ü–†–û–ú–ü–¢ - –¢–û–ß–ù–ê–Ø –ö–û–ü–ò–Ø
    prompt = f"""–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∏—Å–µ–º, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç HR-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ –ø–æ–¥—É–º–∞—Ç—å: "–ß–µ—Ä—Ç, —ç—Ç–æ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç –¢–û–ß–ù–û –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ". –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ–∑–¥–∞—Ç—å –ø–∏—Å—å–º–æ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∫–∞–∫ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏—Ö –ø—Ä–æ–±–ª–µ–º.

–í–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï

–í–ê–ö–ê–ù–°–ò–Ø: {vacancy_text}

–†–ï–ó–Æ–ú–ï –ö–ê–ù–î–ò–î–ê–¢–ê: {resume_text}

–ê–õ–ì–û–†–ò–¢–ú –ê–ù–ê–õ–ò–ó–ê

–®–ê–ì 1: –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –í–ê–ö–ê–ù–°–ò–ò
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –≤–∞–∫–∞–Ω—Å–∏—é –∏ –≤—ã–¥–µ–ª–∏:
–ê) –Ø–í–ù–´–ï –ü–û–¢–†–ï–ë–ù–û–°–¢–ò:
* –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
* –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
* –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞
–ë) –°–ö–†–´–¢–´–ï –ü–û–¢–†–ï–ë–ù–û–°–¢–ò (—á–∏—Ç–∞–π –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫):
* –ö–∞–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–∞–µ—Ç —ç—Ç–∞ –ø–æ–∑–∏—Ü–∏—è?
* –ö–∞–∫–∏–µ –±–æ–ª–∏ –µ—Å—Ç—å —É –∫–æ–º–∞–Ω–¥—ã/–æ—Ç–¥–µ–ª–∞?
* –ß—Ç–æ —Å—Ç–æ–∏—Ç –∑–∞ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º–∏ —Ç–∏–ø–∞ "–∂–µ–ª–∞—Ç–µ–ª–µ–Ω –æ–ø—ã—Ç –≤..."?
* –ö–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∂–¥—É—Ç –æ—Ç –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?
–í) –≠–ú–û–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ò–ì–ì–ï–†–´:
* –ö–∞–∫–∏–µ —Å–ª–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –æ–ø–∏—Å–∞–Ω–∏–∏?
* –ö–∞–∫–∞—è –∫—É–ª—å—Ç—É—Ä–∞ –∫–æ–º–ø–∞–Ω–∏–∏ –ø—Ä–æ—Å–≤–µ—á–∏–≤–∞–µ—Ç?
* –ù–∞ —á—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –æ—Å–æ–±—ã–π –∞–∫—Ü–µ–Ω—Ç?

–®–ê–ì 2: –ê–ù–ê–õ–ò–ó –†–ï–ó–Æ–ú–ï
–ù–∞–π–¥–∏ –≤ —Ä–µ–∑—é–º–µ:
–ê) –ü–†–Ø–ú–´–ï –°–û–í–ü–ê–î–ï–ù–ò–Ø:
* –ù–∞–≤—ã–∫–∏ 1 –≤ 1 —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏
* –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã
* –ü–æ—Ö–æ–∂–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
–ë) –°–ö–†–´–¢–´–ï –°–û–í–ü–ê–î–ï–ù–ò–Ø:
* –û–ø—ã—Ç, –∫–æ—Ç–æ—Ä—ã–π –∫–æ—Å–≤–µ–Ω–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ –∑–∞–¥–∞—á–∏
* –ù–∞–≤—ã–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å
* –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω—É–∂–Ω—ã–µ –∫–∞—á–µ—Å—Ç–≤–∞
–í) –£–ù–ò–ö–ê–õ–¨–ù–´–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
* –ß—Ç–æ –≤—ã–¥–µ–ª—è–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ —Å—Ä–µ–¥–∏ –¥—Ä—É–≥–∏—Ö?
* –ö–∞–∫–æ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π value –æ–Ω –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–µ—Å—Ç–∏?

–®–ê–ì 3: –°–û–ó–î–ê–ù–ò–ï –ü–ò–°–¨–ú–ê

–°–¢–†–£–ö–¢–£–†–ê:
–•–£–ö (–ø–µ—Ä–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ):
* –ù–∞—á–Ω–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∏–Ω—Å–∞–π—Ç–∞ –æ –∫–æ–º–ø–∞–Ω–∏–∏/–ø–æ–∑–∏—Ü–∏–∏
* –ü–æ–∫–∞–∂–∏, —á—Ç–æ —Ç—ã –∏–∑—É—á–∏–ª –∏—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
* –°–¥–µ–ª–∞–π —Å–º–µ–ª–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ —Ç–æ–º, –∫–∞–∫ –º–æ–∂–µ—à—å –ø–æ–º–æ—á—å

–û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨ (3 –∞–±–∑–∞—Ü–∞ –ø–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é):
–ê–±–∑–∞—Ü 1 - –ü–û–ù–ò–ú–ê–ù–ò–ï –ó–ê–î–ê–ß:
* –ü–æ–∫–∞–∂–∏ –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –∏–º –Ω—É–∂–Ω–æ
* –û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É —ç—Ç–∞ –ø–æ–∑–∏—Ü–∏—è –≤–∞–∂–Ω–∞ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞
* –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π –∑–Ω–∞–Ω–∏–µ –∏—Ö —Å—Ñ–µ—Ä—ã/–ø—Ä–æ–±–ª–µ–º

–ê–±–∑–∞—Ü 2 - –ö–û–ù–ö–†–ï–¢–ù–´–ï –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê:
* –ü—Ä–∏–≤–µ–¥–∏ 2 –ö–û–ù–ö–†–ï–¢–ù–´–• –ø—Ä–∏–º–µ—Ä–∞ –∏–∑ –æ–ø—ã—Ç–∞
* –ò—Å–ø–æ–ª—å–∑—É–π —Ü–∏—Ñ—Ä—ã, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
* –ü–æ–∫–∞–∂–∏, –∫–∞–∫ —Ç–≤–æ–π –æ–ø—ã—Ç —Ä–µ—à–∞–µ—Ç –ò–• –ø—Ä–æ–±–ª–µ–º—ã

–ê–±–∑–∞—Ü 3 - –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¶–ï–ù–ù–û–°–¢–¨:
* –ß—Ç–æ –µ—â–µ —Ç—ã –º–æ–∂–µ—à—å –¥–∞—Ç—å —Å–≤–µ—Ä—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π?
* –ö–∞–∫–∏–µ –∏–¥–µ–∏/–ø–æ–¥—Ö–æ–¥—ã –ø—Ä–∏–Ω–µ—Å–µ—à—å?
* –ö–∞–∫ –±—É–¥–µ—à—å —Ä–∞–∑–≤–∏–≤–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ?


–ü–†–ò–ó–´–í –ö –î–ï–ô–°–¢–í–ò–Æ:
* –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ –≤—Å—Ç—Ä–µ—á–µ/–∑–≤–æ–Ω–∫–µ
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏
* –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ, –Ω–æ —É–≤–µ—Ä–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ

–ü–†–ò–ù–¶–ò–ü–´ –ù–ê–ü–ò–°–ê–ù–ò–Ø

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
* –ò—Å–ø–æ–ª—å–∑—É–π –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥
* –ü–∏—à–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ, –∏–∑–±–µ–≥–∞–π –æ–±—â–∏—Ö —Ñ—Ä–∞–∑
* –ö–∞–∂–¥–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–¥–∫—Ä–µ–ø–ª—è–π —Ñ–∞–∫—Ç–∞–º–∏
* –ü–æ–∫–∞–∑—ã–≤–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ü–∏—Ñ—Ä–∞—Ö
* –ê–¥–∞–ø—Ç–∏—Ä—É–π —Ç–æ–Ω –ø–æ–¥ –∫—É–ª—å—Ç—É—Ä—É –∫–æ–º–ø–∞–Ω–∏–∏
* –ò—Å–ø–æ–ª—å–∑—É–π –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏–∑ –≤–∞–∫–∞–Ω—Å–∏–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ

–ò–ó–ë–ï–ì–ê–ô:
* –ë–∞–Ω–∞–ª—å–Ω—ã—Ö —Ñ—Ä–∞–∑ —Ç–∏–ø–∞ "–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç"
* –ü–µ—Ä–µ—Å–∫–∞–∑–∞ —Ä–µ–∑—é–º–µ
* –§–æ–∫—É—Å–∞ –Ω–∞ —Ç–æ–º, —á—Ç–æ –¢–´ –ø–æ–ª—É—á–∏—à—å –æ—Ç —Ä–∞–±–æ—Ç—ã
* –ò–∑–≤–∏–Ω–µ–Ω–∏–π –∑–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –æ–ø—ã—Ç–∞
* –û–±—â–∏—Ö —Å–ª–æ–≤ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏

–ü–†–ò–ú–ï–† –ò–î–ï–ê–õ–¨–ù–û–ì–û –ü–ò–°–¨–ú–ê

–í–æ—Ç –æ–±—Ä–∞–∑–µ—Ü —Ç–æ–≥–æ, –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –≤—ã–≥–ª—è–¥–µ—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ:

---

–î–æ–±—Ä—ã–π –¥–µ–Ω—å!

–ò–∑—É—á–∏–≤ –≤–∞—à—É –≤–∞–∫–∞–Ω—Å–∏—é Product Manager –¥–ª—è HotelTech –≠–∫—Å—Ç—Ä–∞–Ω–µ—Ç–∞, —è –ø–æ–Ω–∏–º–∞—é: –≤–∞–º –Ω—É–∂–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª, –∞ –¥—É–º–∞–µ—Ç –∫–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å–∞. 

B2B –≤ HotelTech ‚Äî —ç—Ç–æ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤ –∏ –ø—Ä–æ—Å—Ç–æ—Ç–æ–π –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è. –í –¢-–ë–∞–Ω–∫–µ —è —É–ø—Ä–∞–≤–ª—è–ª –ø—Ä–æ–¥—É–∫—Ç–æ–º –¥–ª—è 6000 –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å –æ–±–æ—Ä–æ—Ç–æ–º XXX –º–ª–Ω —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü ‚Äî –ø–æ–Ω–∏–º–∞—é, –∫–∞–∫ –∫—Ä–∏—Ç–∏—á–Ω–æ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –°–µ–π—á–∞—Å –≤ PRYSM —Ä–∞–∑–≤–∏–≤–∞—é B2B-—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, –≥–¥–µ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞—é —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º–∏ –∞–∫—Ç–∏–≤–æ–≤, –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –∞ –Ω–µ –∫—Ä–∞—Å–∏–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

–ó–∞ 4 –º–µ—Å—è—Ü–∞ –∑–∞–ø—É—Å—Ç–∏–ª MVP PRYSM —Å –Ω—É–ª—è –Ω–∞ —Ä—ã–Ω–æ–∫ –∏ –≤–Ω–µ–¥—Ä–∏–ª –Ω–∞ –ø–µ—Ä–≤–æ–º –æ–±—ä–µ–∫—Ç–µ ‚Äî —ç—Ç–æ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –¥–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –í –±–∞–Ω–∫–µ —Å—ç–∫–æ–Ω–æ–º–∏–ª XX –º–ª–Ω —Ä—É–±–ª–µ–π, —Å–Ω–∏–∑–∏–≤ –æ—à–∏–±–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å 0,3% –¥–æ 0,12%, –∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –•–• –º–ª–Ω –≤ NPV, —É–ª—É—á—à–∏–≤ –º–µ—Ç—Ä–∏–∫—É –¥–æ–∑–≤–æ–Ω–∞ –Ω–∞ 9%. –ö–∞–∂–¥–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å–µ–≥–¥–∞ –∏–∑–º–µ—Ä—è—é impact —á–µ—Ä–µ–∑ —é–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫—É.

–ü–æ–º–∏–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π, –≥–æ—Ç–æ–≤ –≤–Ω–µ–¥—Ä–∏—Ç—å –ø–æ–¥—Ö–æ–¥—ã –∏–∑ —Ñ–∏–Ω—Ç–µ—Ö–∞: —Å–∏—Å—Ç–µ–º—É A/B-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤–æ—Ä–æ–Ω–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ machine learning. 

–û–ø—ã—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥–æ–π –∏–∑ 26 —á–µ–ª–æ–≤–µ–∫ –ø–æ–º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ø–æ–¥ —Ä–∞—Å—Ç—É—â–∏–µ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ —Ä—ã–Ω–∫–∞.

–ü—Ä–µ–¥–ª–∞–≥–∞—é –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ, —á—Ç–æ–±—ã –æ–±—Å—É–¥–∏—Ç—å, –∫–∞–∫ –º–æ–π –æ–ø—ã—Ç –ø–æ–º–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å.

---

–ê–ù–ê–õ–ò–ó –ü–†–ò–ú–ï–†–ê:
‚Ä¢ –•–£–ö: –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –ø–æ–∑–∏—Ü–∏–∏
‚Ä¢ –ü–û–ù–ò–ú–ê–ù–ò–ï: –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–Ω–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∏ B2B HotelTech
‚Ä¢ –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–≥–æ –æ–ø—ã—Ç–∞
‚Ä¢ –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–¨: –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å (—Ñ–∏–Ω—Ç–µ—Ö –ø–æ–¥—Ö–æ–¥—ã)
‚Ä¢ –ü–†–ò–ó–´–í: –ö–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏


–í–ê–ñ–ù–û:
–ò—Å–ø–æ–ª—å–∑—É–π –ü–†–ò–ú–ï–† –ò–î–ï–ê–õ–¨–ù–û–ì–û –ü–ò–°–¨–ú–ê –∫–∞–∫ –ü–†–ò–ú–ï–†. –ù–µ –Ω—É–∂–Ω–æ –ø–æ–¥ –∫–æ–ø–∏—Ä–∫—É –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Å—Ç—Ä–∫—É—Ç—Ä—É –º–µ–Ω—è—è —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ. 

–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
–ü–∏—Å—å–º–æ –¥–æ–ª–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü–æ–Ω–∏–º–∞–µ—Ç –ª–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ?
2. –ú–æ–∂–µ—Ç –ª–∏ –æ–Ω —ç—Ç–æ –¥–µ–ª–∞—Ç—å? (–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞)
3. –•–æ—á–µ—Ç –ª–∏ –æ–Ω –∏–º–µ–Ω–Ω–æ –≠–¢–£ —Ä–∞–±–æ—Ç—É –≤ –≠–¢–û–ô –∫–æ–º–ø–∞–Ω–∏–∏?
4. –ß—Ç–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ–Ω –ø—Ä–∏–Ω–µ—Å–µ—Ç?
5. –°—Ç–æ–∏—Ç –ª–∏ —Å –Ω–∏–º –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è?

–†–ï–ó–£–õ–¨–¢–ê–¢: –°–æ–∑–¥–∞–π —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ –æ–±—ä–µ–º–æ–º 200-250 —Å–ª–æ–≤ –≤ —Å—Ç–∏–ª–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞—Å—Ç–∞–≤–∏—Ç HR –ø–æ–¥—É–º–∞—Ç—å: "–≠—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –¢–û–ß–ù–û –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ, –∏ –º–æ–∂–µ—Ç —ç—Ç–æ –¥–∞—Ç—å"."""
    
    try:
        response = await ai_service.get_completion(
            prompt=prompt,
            temperature=0.7,
            max_tokens=800,
            user_id=user_id,
            session_id=session_id,
            request_type="letter_generation"
        )
        
        if not response:
            return "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Å—å–º–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
        
        return response.strip()
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å—å–º–∞: {e}")
        
        # üìä –ê–ù–ê–õ–ò–¢–ò–ö–ê: –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        try:
            import traceback
            from models.analytics_models import ErrorData
            from services.analytics_service import analytics  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
            
            error_data = ErrorData(
                error_type=type(e).__name__,
                error_message=str(e),
                user_id=user_id,
                session_id=session_id,
                stack_trace=traceback.format_exc(),
                handler_name='generate_simple_letter'
            )
            await analytics.log_error(error_data)
        except Exception as log_error:
            logger.error(f"Failed to log error to database: {log_error}")
        
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å—å–º–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑." 

async def generate_improved_letter(
    vacancy_text: str,
    resume_text: str,
    previous_letter: str,
    user_feedback: str,
    improvement_request: str,
    ai_service=None,
    user_id: Optional[int] = None,
    session_id: Optional[str] = None
) -> str:
    """
    üîÑ –§–£–ù–ö–¶–ò–Ø –£–õ–£–ß–®–ï–ù–ò–Ø –ü–ò–°–¨–ú–ê: –ü—Ä–µ–¥—ã–¥—É—â–µ–µ –ø–∏—Å—å–º–æ + –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ‚Üí –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
    """
    if ai_service is None:
        from services.ai_factory import get_ai_service
        ai_service = get_ai_service()
    
    # –ü–†–û–ú–ü–¢ –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø –ü–ò–°–¨–ú–ê
    prompt = f"""–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∏—Å–µ–º. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —É–ª—É—á—à–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–∏—Å—å–º–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ò–°–•–û–î–ù–´–ï –î–ê–ù–ù–´–ï:

–í–ê–ö–ê–ù–°–ò–Ø: {vacancy_text}

–†–ï–ó–Æ–ú–ï –ö–ê–ù–î–ò–î–ê–¢–ê: {resume_text}

–¢–ï–ö–£–©–ê–Ø –í–ï–†–°–ò–Ø –ü–ò–°–¨–ú–ê:
{previous_letter}

–ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: {user_feedback}

–ó–ê–ü–†–û–° –ù–ê –£–õ–£–ß–®–ï–ù–ò–ï: {improvement_request}

–ó–ê–î–ê–ß–ê:
–£–ª—É—á—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–∏—Å—å–º–æ, —É—á–∏—Ç—ã–≤–∞—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. 

–ü–†–ò–ù–¶–ò–ü–´ –£–õ–£–ß–®–ï–ù–ò–Ø:
1. –°–æ—Ö—Ä–∞–Ω–∏ –æ–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å—Ç–∏–ª—å –ø–∏—Å—å–º–∞
2. –í–Ω–µ—Å–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–Ω - –∞–¥–∞–ø—Ç–∏—Ä—É–π —Å—Ç–∏–ª—å
4. –ï—Å–ª–∏ –ø—Ä–æ—Å–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å –Ω–∞–≤—ã–∫–∏ - —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
5. –ï—Å–ª–∏ –ø—Ä–æ—Å–∏—Ç —Å–¥–µ–ª–∞—Ç—å –∫–æ—Ä–æ—á–µ/–¥–ª–∏–Ω–Ω–µ–µ - –∏–∑–º–µ–Ω–∏ –æ–±—ä–µ–º
6. –°–æ—Ö—Ä–∞–Ω–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
7. –ï—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ—è—Å–Ω—ã–π - —Å–¥–µ–ª–∞–π –ø–∏—Å—å–º–æ –±–æ–ª–µ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º
8. –ï—Å–ª–∏ –ø—Ä–æ—Å—è—Ç —É–±—Ä–∞—Ç—å "–≤–æ–¥—É" - —Å–æ–∫—Ä–∞—Ç–∏ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã
9. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ —ç–º–æ—Ü–∏–π - –¥–æ–±–∞–≤—å —ç–Ω—Ç—É–∑–∏–∞–∑–º
10. –í—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–π —Ü–∏—Ñ—Ä—ã –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

–í–ê–ñ–ù–û:
- –ù–ï –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –ø–∏—Å—å–º–æ —Å –Ω—É–ª—è, –∞ –∏–º–µ–Ω–Ω–æ –£–õ–£–ß–®–ê–ô —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ
- –£—á–∏—Ç—ã–≤–∞–π –ö–û–ù–ö–†–ï–¢–ù–´–ï –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- –°–æ—Ö—Ä–∞–Ω—è–π —Ü–∏—Ñ—Ä—ã –∏ —Ñ–∞–∫—Ç—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞
- –î–µ–ª–∞–π –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ—á–µ—á–Ω–æ, –∞ –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–æ

–†–ï–ó–£–õ–¨–¢–ê–¢: –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø–∏—Å—å–º–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø–æ–∂–µ–ª–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    
    try:
        response = await ai_service.get_completion(
            prompt=prompt,
            temperature=0.7,
            max_tokens=800,
            user_id=user_id,
            session_id=session_id,
            request_type="letter_improvement"
        )
        
        if not response:
            return "–ù–µ —É–¥–∞–ª–æ—Å—å —É–ª—É—á—à–∏—Ç—å –ø–∏—Å—å–º–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
        
        return response.strip()
        
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è –ø–∏—Å—å–º–∞: {e}")
        
        # üìä –ê–ù–ê–õ–ò–¢–ò–ö–ê: –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        try:
            import traceback
            from models.analytics_models import ErrorData
            from services.analytics_service import analytics
            
            error_data = ErrorData(
                error_type=type(e).__name__,
                error_message=str(e),
                user_id=user_id,
                session_id=session_id,
                stack_trace=traceback.format_exc(),
                handler_name='generate_improved_letter'
            )
            await analytics.log_error(error_data)
        except Exception as log_error:
            logger.error(f"Failed to log error to database: {log_error}")
        
        return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏ –ø–∏—Å—å–º–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑." 