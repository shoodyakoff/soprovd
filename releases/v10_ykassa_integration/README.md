# üöÄ Release v10.0 - –ÆKassa Integration

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** –ò—é–ª—å 2025  
**–¢–∏–ø:** Major  

## üéØ –¶–µ–ª—å —Ä–µ–ª–∏–∑–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ –ÆKassa –¥–ª—è Telegram –±–æ—Ç–∞. –ó–∞–º–µ–Ω–∞ —Ä—É—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏—Å—Ç–µ–º—É —Å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π Premium –ø–æ–¥–ø–∏—Å–æ–∫.

## üìã –ó–∞–¥–∞—á–∏ —Ä–µ–ª–∏–∑–∞

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏
- **v10.1** –ÆKassa Integration - –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
  - –°–æ–∑–¥–∞–Ω–∏–µ payment_service.py –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ÆKassa API
  - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è webhook_handler.py –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ handlers –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–æ–¥–ø–∏—Å–æ–∫
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã `/subscription` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
- **v10.2** Database Migration - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –ÆKassa –≤ —Ç–∞–±–ª–∏—Ü—É payments
  - –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢—Ä–µ–±—É–µ–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
- `v10.1_add_yookassa_payments.sql` - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
1. –°–æ–∑–¥–∞—Ç—å backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é v10.1_add_yookassa_payments.sql
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
4. –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏:
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –≤ Premium –Ω–∞ 300% (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è vs —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- **Retention:** –£–ª—É—á—à–µ–Ω–∏–µ —É–¥–µ—Ä–∂–∞–Ω–∏—è –∑–∞ —Å—á–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- **Revenue:** –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç –æ–ø–ª–∞—Ç—ã –¥–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å 1 —á–∞—Å–∞ –¥–æ 1 –º–∏–Ω—É—Ç—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏:
- **Performance:** –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞ < 10 —Å–µ–∫—É–Ω–¥
- **Scalability:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- **Reliability:** 99.9% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook'–æ–≤

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- [ ] –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ —Ñ–ª–æ—É
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ fallback –ª–æ–≥–∏–∫–∏ –ø—Ä–∏ —Å–±–æ—è—Ö
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
- [ ] UI/UX —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫
- [x] Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [x] Fallback –ª–æ–≥–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/subscription` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- [ ] –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ü–ª–∞—Ç–µ–∂–Ω—ã–π —Ñ–ª–æ—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [x] Webhook —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [x] Fallback –ª–æ–≥–∏–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- [x] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [x] –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/subscription` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üö® –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ —Ä–∏—Å–∫–∏:
- **–†–∏—Å–∫ 1:** –°–±–æ–∏ –≤ —Ä–∞–±–æ—Ç–µ –ÆKassa API
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è:* Fallback –Ω–∞ —Ä—É—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API
- **–†–∏—Å–∫ 2:** –ü—Ä–æ–±–ª–µ–º—ã —Å webhook –¥–æ—Å—Ç–∞–≤–∫–æ–π
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è:* Retry –ª–æ–≥–∏–∫–∞, —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–µ–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ngrok` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏.
- **–†–∏—Å–∫ 3:** –û—à–∏–±–∫–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è:* Backup –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π, rollback –ø–ª–∞–Ω

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞:
1. –û—Ç–∫–ª—é—á–∏—Ç—å –ÆKassa –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ feature flag
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
3. –í—Ä–µ–º—è –æ—Ç–∫–∞—Ç–∞: 5 –º–∏–Ω—É—Ç

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook'–æ–≤
- –í—Ä–µ–º—è –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ fallback –∞–∫—Ç–∏–≤–∞—Ü–∏–π

### –ê–ª–µ—Ä—Ç—ã:
- –û—à–∏–±–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- –°–±–æ–∏ webhook –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç fallback –∞–∫—Ç–∏–≤–∞—Ü–∏–π

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ](tasks/TZ_v10_1_Ykassa_Integration.md)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è](docs/ARCHITECTURE.md)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](docs/API.md)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ÆKassa –∏ –ø–æ–ª—É—á–µ–Ω–∏—è API –∫–ª—é—á–µ–π
- Webhook URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (Railway)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ –ÆKassa

### üîÑ –ò—Ç–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è:** –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ÆKassa (—Å–º. `TZ_NUANCES_REPORT.md`)
- **–í—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è:** UX/UI –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ backend –ª–æ–≥–∏–∫–∞ (—Å–º. `TZ_NUANCES_REPORT_v2.md`)
- **–¢—Ä–µ—Ç—å—è –∏—Ç–µ—Ä–∞—Ü–∏—è:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å `pending` —Å—Ç–∞—Ç—É—Å–æ–º –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã `/subscription` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏.

---

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** @shoodyakoff  
**–†–µ–≤—å—é–µ—Ä—ã:** –ö–æ–º–∞–Ω–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏  
**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 30 –∏—é–Ω—è 2025

# üí≥ –ù–ê–°–¢–†–û–ô–ö–ê –ÆKASSA - –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø

## üöÄ –≠–¢–ê–ü 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ –ÆKassa

### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
1. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ https://yookassa.ru/
2. –ù–∞–∂–∏–º–∞–µ–º "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è"
3. –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Å–µ–±–µ/–∫–æ–º–ø–∞–Ω–∏–∏:
   - –î–ª—è –ò–ü: –ò–ù–ù, –û–ì–†–ù–ò–ü, –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
   - –î–ª—è –û–û–û: –ò–ù–ù, –û–ì–†–ù, –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã
   - –î–ª—è —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã—Ö: –Ω–æ–º–µ—Ä —Å–ø—Ä–∞–≤–∫–∏ –æ —Å—Ç–∞—Ç—É—Å–µ

### 1.2 –¢–µ—Å—Ç–æ–≤—ã–π –¥–æ—Å—Ç—É–ø
- –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É
- –í —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å fake –ø–ª–∞—Ç–µ–∂–∏
- –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç: https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing

## üîë –≠–¢–ê–ü 2: –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

### 2.1 –í—Ö–æ–¥ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
1. –ó–∞—Ö–æ–¥–∏–º –≤ https://yookassa.ru/my/
2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–∞–∑–¥–µ–ª "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è" ‚Üí "API –∏ Webhook"

### 2.2 –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª—é—á–µ–π
```bash
# –í —Ä–∞–∑–¥–µ–ª–µ "–î–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏" –Ω–∞–π–¥–µ—Ç–µ:
shop_id: "123456"              # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞–≥–∞–∑–∏–Ω–∞
secret_key: "test_abcd1234..."  # –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á (–¢–ï–°–¢–û–í–´–ô)

# –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –±—É–¥—É—Ç –¥—Ä—É–≥–∏–µ –∫–ª—é—á–∏ –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏
```

### 2.3 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ Railway
–í –ø–∞–Ω–µ–ª–∏ Railway ‚Üí Variables –¥–æ–±–∞–≤–∏—Ç—å:
```
YOOKASSA_SHOP_ID=123456
YOOKASSA_SECRET_KEY=test_abcd1234...
YOOKASSA_ENABLED=true
```

## üîó –≠–¢–ê–ü 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

### 3.1 URL –¥–ª—è webhook
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤ Railway –ø–æ–ª—É—á–∏—Ç–µ URL:
```
https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.railway.app/webhook/yookassa
```
–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∏ webhook'–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ngrok` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Ç—É–Ω–Ω–µ–ª—è –Ω–∞ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä.

### 3.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ÆKassa
1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ ‚Üí "API –∏ Webhook"
2. –í —Ä–∞–∑–¥–µ–ª–µ "Webhook" –Ω–∞–∂–∞—Ç—å "–ù–∞—Å—Ç—Ä–æ–∏—Ç—å"
3. –£–∫–∞–∑–∞—Ç—å URL: `https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.railway.app/webhook/yookassa`
4. –í—ã–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ `payment.succeeded` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
   - ‚úÖ `payment.canceled` - –æ—Ç–º–µ–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
   - ‚úÖ `refund.succeeded` - –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

### 3.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook
```bash
# –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
curl https://–≤–∞—à-–ø—Ä–æ–µ–∫—Ç.railway.app/webhook/health

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
{
  "status": "healthy",
  "payments_enabled": true,
  "test_mode": true
}
```

## üß™ –≠–¢–ê–ü 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 4.1 –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç
```
–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞:
–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: 5555 5555 5555 4444
–°—Ä–æ–∫: 12/24
CVC: 123

–û—Ç–∫–ª–æ–Ω–µ–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞:
–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: 5555 5555 5555 5557
–°—Ä–æ–∫: 12/24
CVC: 123
```

### 4.2 –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
1. –í –±–æ—Ç–µ –Ω–∞–∂–∞—Ç—å "–ü–æ–ª—É—á–∏—Ç—å Premium"
2. –ù–∞–∂–∞—Ç—å "–û–ø–ª–∞—Ç–∏—Ç—å 199‚ÇΩ"
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ÆKassa –≤–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞—Ç–µ–∂
5. –î–æ–ª–∂–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è Premium

### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```bash
# –í Railway –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
‚úÖ Payment created: payment_id for user 123
üîî Received –ÆKassa webhook, event=payment.succeeded
‚úÖ Premium subscription activated for user 123
```

## üîí –≠–¢–ê–ü 5: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 5.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
–í `webhook_handler.py` –≤–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏:
```python
def verify_webhook_signature(body: bytes, signature: str) -> bool:
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å –æ—Ç –ÆKassa
    # –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö webhook'–æ–≤
```

### 5.2 HTTPS –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
- Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS
- –ÆKassa —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å HTTPS webhook'–∞–º–∏

### 5.3 –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏
```bash
# –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ git:
YOOKASSA_SECRET_KEY=live_secret_key

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Railway
```

## üöÄ –≠–¢–ê–ü 6: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

### 6.1 –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ÆKassa
1. –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω
2. –ü—Ä–∏–ª–æ–∂–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã:
   - –£—Å—Ç–∞–≤/–¥–æ–≥–æ–≤–æ—Ä –ò–ü
   - –°–ø—Ä–∞–≤–∫–∞ –∏–∑ –±–∞–Ω–∫–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞
3. –î–æ–∂–¥–∞—Ç—å—Å—è –æ–¥–æ–±—Ä–µ–Ω–∏—è (1-3 –¥–Ω—è)

### 6.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π
–ü–æ—Å–ª–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è:
```bash
# –ó–∞–º–µ–Ω–∏—Ç—å –≤ Railway:
YOOKASSA_SHOP_ID=live_shop_id
YOOKASSA_SECRET_KEY=live_secret_key
```

### 6.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–µ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
- –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –∏—Å—á–µ–∑–Ω—É—Ç—å `test_mode: true`
- –†–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –±—É–¥—É—Ç —Å–ø–∏—Å—ã–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏
- Webhook –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω URL

## üìä –≠–¢–ê–ü 7: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 7.1 –ú–µ—Ç—Ä–∏–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–µ–∫–∞–µ—Ç:
- `payment_created` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- `payment_succeeded` - —É—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
- `payment_link_shown` - –ø–æ–∫–∞–∑ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É

### 7.2 –î–∞—à–±–æ—Ä–¥ –ÆKassa
–í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤

### 7.3 –õ–æ–≥–∏ –≤ Railway
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:
grep "Payment created" logs
grep "Premium subscription activated" logs
grep "–ÆKassa webhook" logs
```

## ‚ùó –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:
1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ñ–ª–æ—É –æ–ø–ª–∞—Ç—ã
2. **Webhook**: –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –±—ã—Å—Ç—Ä–æ (< 10 —Å–µ–∫), –∏–Ω–∞—á–µ –ÆKassa –±—É–¥–µ—Ç —Ä–µ—Ç—Ä–∞–∏—Ç—å
3. **–î—É–±–ª–∏**: –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
4. **Rollback**: –ï—Å—Ç—å fallback –Ω–∞ —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É –µ—Å–ª–∏ –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

### ‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL, HTTPS, –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∞
2. **–ü–ª–∞—Ç–µ–∂ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ webhook'–∞
3. **–¢–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. **–ü–æ–¥–ø–∏—Å—å –Ω–µ–≤–µ—Ä–Ω–∞**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SECRET_KEY –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### üí° –°–æ–≤–µ—Ç—ã:
1. –ù–∞—á–∏–Ω–∞–π—Ç–µ —Å —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
2. –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ —ç—Ç–∞–ø—ã –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
3. –ü—Ä–µ–¥—É—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä—É—á–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é —á–µ—Ä–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫—É
4. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–æ–Ω–≤–µ—Ä—Å–∏—é: –ø–æ–∫–∞–∑—ã ‚Üí –∫–ª–∏–∫–∏ ‚Üí –ø–ª–∞—Ç–µ–∂–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–ÆKassa –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: support@yookassa.ru
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://yookassa.ru/developers/
- **–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∞**: @shoodyakoff

---

‚úÖ **–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É –≤–∞—Å –±—É–¥–µ—Ç:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ –ÆKassa
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è Premium –ø–æ–¥–ø–∏—Å–æ–∫  
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ webhook'–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–æ–¥–ø–∏—Å–∏
- –ü–æ–ª–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- Fallback –Ω–∞ —Ä—É—á–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–∏ —Å–±–æ—è—Ö 
- –ö–æ–º–∞–Ω–¥–∞ `/subscription` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏

## üü¢ –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è Premium
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–ø–ª–∞—Ç–µ Premium –ø–æ–¥–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è: –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –µ—â–µ –∞–∫—Ç–∏–≤–Ω–∞, –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 30 –¥–Ω–µ–π; –µ—Å–ª–∏ –∏—Å—Ç–µ–∫–ª–∞ ‚Äî –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ —Å —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã.
- –≠—Ç–æ –±—ã–ª–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –≤ —Ö–æ–¥–µ –æ—Ç–ª–∞–¥–∫–∏: –Ω–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç, –∞ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—É—é.
- –ü–æ–¥—Ä–æ–±–Ω–µ–µ: —Å–º. TZ_NUANCES_REPORT_v3.md

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–ª–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–ø–ª–∞—Ç–µ –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 30 –¥–Ω–µ–π.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –¥–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è = —Å–µ–≥–æ–¥–Ω—è + 30 –¥–Ω–µ–π.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø—Ä–æ–¥–ª–µ–Ω–∏–∏.

## üü¢ v10.1.2 (–∏—é–ª—å 2025) ‚Äî UX, –±–∞–≥—Ñ–∏–∫—Å—ã, —Ü–µ–Ω–∞ 1‚ÇΩ (—Ç–æ–ª—å–∫–æ –≤ —Å—Å—ã–ª–∫–µ)
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã —ç–∫—Ä–∞–Ω –æ–ø–ª–∞—Ç—ã —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- –ù–∞ —ç–∫—Ä–∞–Ω–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ Premium —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ"
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º letter_session
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- –¶–µ–Ω–∞ Premium ‚Äî 1‚ÇΩ —Ç–æ–ª—å–∫–æ –≤ —Å—Å—ã–ª–∫–µ –Ω–∞ –æ–ø–ª–∞—Ç—É (UI –∏ —Ç–µ–∫—Å—Ç—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) 